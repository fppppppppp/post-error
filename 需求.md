r### 前端监控 
---

#### 一、前端异常监控
前端项目上线后，由于用户访问的环境位于用户终端。开发人员无法获取到用户使用过程中碰到的一些异常信息。  
但是线上的bug又是难以避免的，这个时候就需要一个线上异常的日志收集。在发现异常报错信息的时候，及时的通过api将信息上报到服务端。然后再通知到相应的开发运维人员。排除线上bug。极大的降低异常对用户造成的干扰。

---
1. 主要分为四个阶段  

日志采集 => 日志存储 => 统计与分析 => 报告和警告;  

异常日志采集内容:
> javascript异常（语法错误，运行时错误，跨域脚本）  
> 资源加载异常（img js css）  
> ajax请求异常  
> promise异常  
> react、vue、react 项目中全局异常捕获  
> 小程序的异常信息捕获

---
2. 项目设计

- 数据上传模块 采用gif的图片访问
- 定时发送数据模块
- 每个用户打开页面生成一个id
- 异常信息监测采集
> who: appid(系统或者应用的id),userAgent(用户的系统、网络等信息)
> when: timestamp(上报的时间戳)
> from where: currentUrl(用户当前url)，fromUrl(从哪一个页面跳转到当前页面)，type(上报的事件类型),element(触发上报事件的元素）
> what: 上报的自定义扩展数据data:{},扩展数据中可以按需求定制，比如包含uid等信息

 

#### 二、前端用户行为收集




#### 三、用户访问统计 （单独的sdk）；
---

1. [前端埋点sdk git地址](https://code.aliyun.com/gzshili/web-point-sdk)

主要用户收集用户system相关信息，用于分析用户的系统分类相关信息；<br>
提供埋点的api，目前没有内嵌到组件中，还需要手动嵌入代码中；<br>
由于过分依赖服务端，目前还需优化;<br>

> todo:
> 1. 能够内嵌到组件 而不是过分依赖手工植入api。
> 2. 对现有数据分类统计。
> 3. 延迟上传(本地先缓存，一段时间上传一次，防止人为的ddos攻击)。
> 4. 优化上传接口,采用业界常用的gif上传。
> 5. 提供钩子在上传前、信息统计前、以及其他相应的钩子供开发人员使用。

2. [前端埋点展示git地址](https://code.aliyun.com/gzshili/web-point-operate.git)  
   [前端埋点展示项目访问路径](http://222.222.222.125/summary/#/hlxj/userInfo)  
目前界面支持用户的system信息展示,以及对相应的数据进行分组归类  
支持路由访问量统计，支持一定时间的统计  
支持子模块的访问量统计，支持一定时间的统计  

> todo:
> 1. 美化界面
> 2. 支持多个项目统一展示
> 3. 更多丰富的信息展示
> 4. 更多丰富的查询接口
> 5. 后续把异常和行为监控纳入其中。
> 6. 对单个用户进行行为分析
> 7. 对用户群进行分类，分析用户的行为相关信息
> 8. 采用热力图的形式还原用户的鼠标轨迹及相应的热点区域
> 9. ...


3. [前端埋点服务端代码git地址](https://code.aliyun.com/gzshili/serve-point.git)

目前该服务只负责查询服务端记录的用户信息，在转成对应的json数据。通过对数据的分类筛选和组合转化成前端所需的数据格式。

> todo:
> 1. 抛弃服务端，统一接管数据收集和入库，以及数据清洗工作
> 2. 接入队列，对上传的数据做缓存，在对数据清洗过后存入db（长久存储）；
> 3. 支持不同的系统信息的收集，提供相应的APPID生成，对应相应的项目
> 4. 提供高效的api，从海量的行为数据中生成相应的统计数据
> 5. 提供报错通知机制（线上的严重错误，及时通知到开发人员）
> 6. 对于异常信息，通过对前端的supermap 找到对应的源码。
> 7. ... 